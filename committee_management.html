<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Committee Management ‚Äî Demo</title>
  <style>
    :root{
      --sky-1: #e8f8ff; /* very light sky */
      --sky-2: #cdefff; /* light sky */
      --sky-3: #6ec8ff; /* vivid sky */
      --accent: #0ea5e9; /* accent */
      --white: #ffffff;
      --muted:#657786;
      --glass: rgba(255,255,255,0.6);
      --card-shadow: 0 10px 25px rgba(2,6,23,0.08);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background: linear-gradient(180deg,var(--sky-1),var(--white));color:#0b1720}

    /* Layout */
    .app{display:flex;min-height:100vh}
    .sidebar{width:260px;background:linear-gradient(180deg,var(--white),var(--sky-2));padding:28px;box-shadow: 4px 0 30px rgba(14,165,233,0.06);position:sticky;top:0;align-self:flex-start}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo{width:46px;height:46px;border-radius:12px;background:linear-gradient(135deg,var(--sky-3),#48b6f7);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 6px 18px rgba(14,165,233,0.16);transform:rotate(-8deg)}
    .brand h1{font-size:18px;margin:0}
    nav{margin-top:6px}
    .nav-item{display:flex;gap:12px;align-items:center;padding:10px 12px;border-radius:10px;color:#013047;margin-bottom:6px;cursor:pointer;transition:all .18s ease}
    .nav-item:hover{background:rgba(14,165,233,0.12);transform:translateX(6px)}
    .nav-item.active{background:linear-gradient(90deg,var(--sky-3),#4db7ff);color:white;box-shadow:0 8px 20px rgba(78,151,255,0.12)}
    .nav-icon{width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.6);display:flex;align-items:center;justify-content:center}

    /* Main */
    .main{flex:1;padding:28px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .search{display:flex;gap:8px;align-items:center;background:var(--white);padding:8px 12px;border-radius:12px;box-shadow:var(--card-shadow)}
    .search input{border:none;background:transparent;outline:none}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--sky-3),#48b6f7);color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(78,151,255,0.12);transition:transform .14s ease}
    .btn:hover{transform:translateY(-3px)}

    /* Dashboard cards */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:var(--white);border-radius:14px;padding:18px;box-shadow:var(--card-shadow);transition:transform .18s ease,box-shadow .18s ease}
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(2,6,23,0.08)}
    .col-3{grid-column:span 3}
    .col-6{grid-column:span 6}
    .col-4{grid-column:span 4}
    .col-12{grid-column:span 12}

    .kpi{display:flex;justify-content:space-between;align-items:center}
    .kpi h3{margin:0}
    .kpi p{margin:6px 0 0;color:var(--muted)}

    /* Table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;text-align:left;border-bottom:1px solid #eef6fb}
    th{color:#044b67}
    tbody tr:hover{background:linear-gradient(90deg,var(--sky-1),var(--white));transform:translateX(0)}

    /* form modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,18,27,0.35);z-index:40}
    .modal.open{display:flex}
    .modal-card{width:560px;background:var(--white);border-radius:12px;padding:18px;box-shadow:0 30px 60px rgba(2,6,23,0.18);animation:pop .18s ease}
    @keyframes pop{from{transform:translateY(12px) scale(.98);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
    .form-row{display:flex;gap:12px;margin-bottom:10px}
    .form-row input, .form-row select{flex:1;padding:10px;border-radius:8px;border:1px solid #dff3ff;background:linear-gradient(180deg,var(--white),var(--sky-1));outline:none}

    /* small UI */
    .muted{color:var(--muted);font-size:13px}
    .table-actions{display:flex;gap:8px}
    .pill{background:linear-gradient(90deg,var(--sky-3),#4db7ff);padding:6px 10px;border-radius:999px;color:white;font-weight:600}

    /* responsive */
    @media (max-width:900px){.sidebar{display:none}.app{flex-direction:column}.main{padding:16px}}

    /* hover effects for rows */
    tbody tr td .link{color:var(--accent);cursor:pointer}

    /* animations */
    .glow{animation:glow 3s ease-in-out infinite}
    @keyframes glow{0%{box-shadow:0 6px 20px rgba(78,151,255,0.06)}50%{box-shadow:0 16px 40px rgba(78,151,255,0.12)}100%{box-shadow:0 6px 20px rgba(78,151,255,0.06)}}

    /* small footer */
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    /* mobile tweaks */
    @media (max-width:640px){.grid{grid-template-columns:repeat(1,1fr)}.card{padding:14px}}
  

/* Responsive Design */
@media (max-width: 1024px) {
  .sidebar { width: 200px; }
  .content { margin-left: 200px; padding: 15px; }
  .topbar { padding: 10px 15px; }
}

@media (max-width: 768px) {
  .sidebar { position: fixed; left: -250px; top: 0; height: 100%; transition: 0.3s; }
  .sidebar.open { left: 0; }
  .menu-toggle { display: block; cursor: pointer; font-size: 22px; margin-right: 10px; }
  .content { margin-left: 0; padding: 15px; }
  .topbar { justify-content: start; gap: 15px; }
}

@media (max-width: 480px) {
  h1 { font-size: 20px; }
  .card { padding: 15px; }
  button { font-size: 14px; padding: 8px 14px; }
  table th, table td { font-size: 13px; padding: 6px; }
}
</style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">CM</div>
        <div>
          <h1>CraftLayer Committee</h1>
          <div class="muted">White ‚Ä¢ Sky Blue ‚Ä¢ Clean UI</div>
        </div>
      </div>

      <nav>
        <div class="nav-item active" data-page="dashboard"> <div class="nav-icon">üè†</div> Dashboard</div>
        <div class="nav-item" data-page="members"> <div class="nav-icon">üë•</div> Members</div>
        <div class="nav-item" data-page="payments"> <div class="nav-icon">üí≥</div> Payments</div>
        <div class="nav-item" data-page="workers"> <div class="nav-icon">üõ†Ô∏è</div> Workers</div>
        <div class="nav-item" data-page="vehicles"> <div class="nav-icon">üèçÔ∏è</div> Vehicles</div>
        <div class="nav-item" data-page="expenses"> <div class="nav-icon">üßæ</div> Expenses</div>
        <div class="nav-item" data-page="reports"> <div class="nav-icon">üìä</div> Reports</div>
        <div class="nav-item" data-page="users"> <div class="nav-icon">üîê</div> User Management</div>
        <div class="nav-item" data-page="settings"> <div class="nav-icon">‚öôÔ∏è</div> Settings</div>
      </nav>

      <div style="margin-top:14px">
        <button class="btn" id="add-member">+ Add Member</button>
      </div>

      <div style="margin-top:20px" class="muted">Tip: Click a menu item to open a page. Data is stored locally in browser (localStorage).</div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="search"><span>üîé</span><input id="global-search" placeholder="Search by house or name..." /></div>
        <div class="actions">
          <div class="muted">Role: <strong id="current-role">Admin</strong></div>
          <button class="btn" id="show-pay-modal">Collect Fee</button>
        </div>
      </div>

      <!-- pages container -->
      <section id="pages">

        <!-- DASHBOARD -->
        <section class="page" id="dashboard">
          <div class="grid">
            <div class="card col-3">
              <div class="kpi">
                <div>
                  <h3 id="total-members">0</h3>
                  <p class="muted">Total Members</p>
                </div>
                <div class="pill glow">Members</div>
              </div>
            </div>
            <div class="card col-3">
              <div class="kpi">
                <div>
                  <h3 id="total-payments">0</h3>
                  <p class="muted">Payments Received</p>
                </div>
                <div class="pill">PKR</div>
              </div>
            </div>
            <div class="card col-6">
              <h3>Recent Payments</h3>
              <div style="margin-top:8px">
                <table>
                  <thead><tr><th>Receipt</th><th>House</th><th>Amount</th><th>By</th></tr></thead>
                  <tbody id="recent-payments"></tbody>
                </table>
              </div>
            </div>

            <div class="card col-4">
              <h3>Quick Actions</h3>
              <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
                <button class="btn" id="gen-defaulter">Generate Defaulter List</button>
                <button class="btn" id="export-data">Export CSV</button>
                <button class="btn" id="clear-data" style="background:#f87171">Clear Local Data</button>
              </div>
            </div>

            <div class="card col-8">
              <h3>Members Table</h3>
              <div style="margin-top:8px">
                <table>
                  <thead><tr><th>#</th><th>House</th><th>Name</th><th>Phone</th></tr></thead>
                  <tbody id="members-table"></tbody>
                </table>
              </div>
            </div>

            <div class="card col-12">
              <h3>Audit Log (Last 10)</h3>
              <div style="margin-top:8px">
                <table>
                  <thead><tr><th>Time</th><th>User</th><th>Module</th><th>Action</th></tr></thead>
                  <tbody id="audit-table"></tbody>
                </table>
              </div>
            </div>

          </div>
        </section>

        <!-- MEMBERS -->
        <section class="page" id="members" style="display:none">
          <div class="card col-12">
            <h3>Members</h3>
            <p class="muted">Add, edit and view members. Address format: B-1/98 etc.</p>
            <div style="margin-top:12px">
              <table>
                <thead><tr><th>#</th><th>House</th><th>Name</th><th>Phone</th><th>Actions</th></tr></thead>
                <tbody id="members-full"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- PAYMENTS -->
        <section class="page" id="payments" style="display:none">
          <div class="card col-12">
            <h3>Payments</h3>
            <div style="margin-top:12px">
              <table>
                <thead><tr><th>Receipt</th><th>House</th><th>Amount</th><th>Month</th><th>Action</th></tr></thead>
                <tbody id="payments-table"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- WORKERS -->
        <section class="page" id="workers" style="display:none">
          <div class="card col-12">
            <h3>Workers</h3>
            <p class="muted">Simple workers list (demo).</p>
            <div style="margin-top:12px">
              <table>
                <thead><tr><th>#</th><th>Name</th><th>Type</th><th>Assigned</th></tr></thead>
                <tbody id="workers-table"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- VEHICLES -->
        <section class="page" id="vehicles" style="display:none">
          <div class="card col-12">
            <h3>Vehicles</h3>
            <p class="muted">Vehicle stickers and expiry alerts.</p>
            <div style="margin-top:12px">
              <table>
                <thead><tr><th>#</th><th>House</th><th>Vehicle</th><th>Sticker Exp</th></tr></thead>
                <tbody id="vehicles-table"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- EXPENSES -->
        <section class="page" id="expenses" style="display:none">
          <div class="card col-12">
            <h3>Expenses</h3>
            <p class="muted">Add monthly society expenses (demo).</p>
            <div style="margin-top:12px">
              <table>
                <thead><tr><th>#</th><th>Category</th><th>Amount</th><th>Date</th></tr></thead>
                <tbody id="expenses-table"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- REPORTS -->
        <section class="page" id="reports" style="display:none">
          <div class="card col-12">
            <h3>Reports</h3>
            <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
              <div style="flex:1;min-width:220px" class="card">
                <h4>Defaulters</h4>
                <div id="defaulter-list" style="margin-top:8px"></div>
              </div>
              <div style="flex:1;min-width:220px" class="card">
                <h4>Audit (All)</h4>
                <div style="margin-top:8px;max-height:220px;overflow:auto">
                  <table><tbody id="audit-full"></tbody></table>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- USERS -->
        <section class="page" id="users" style="display:none">
          <div class="card col-12">
            <h3>User Management</h3>
            <p class="muted">Pre-created roles: Admin / Recovery / Viewer. This demo stores current role in local state.</p>
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <label>Switch Role:</label>
              <select id="role-switch"><option>Admin</option><option>Recovery</option><option>Viewer</option></select>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section class="page" id="settings" style="display:none">
          <div class="card col-12">
            <h3>Settings</h3>
            <p class="muted">Configure receipt prefix/year & WhatsApp behavior for demo.</p>
            <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
              <div style="flex:1;min-width:220px">
                <label>Receipt Prefix</label>
                <input id="receipt-prefix" value="RCPT" />
              </div>
              <div style="flex:1;min-width:220px">
                <label>Enable WhatsApp (opens wa.me)</label>
                <select id="wh-enable"><option value="true">Enabled</option><option value="false">Disabled</option></select>
              </div>
            </div>
          </div>
        </section>

      </section>

      <footer>Built with ‚ù§Ô∏è ‚Äî Demo UI ‚Ä¢ Data saved in browser</footer>
    </main>
  </div>

  <!-- MODALS -->
  <div class="modal" id="member-modal">
    <div class="modal-card">
      <h3>Add Member</h3>
      <div style="margin-top:12px">
        <div class="form-row">
          <input id="m-house" placeholder="House e.g. B-12/34" />
          <input id="m-name" placeholder="Member Name" />
        </div>
        <div class="form-row">
          <input id="m-phone" placeholder="Phone (include country code) e.g. 923xx..." />
          <input id="m-extra" placeholder="Notes (optional)" />
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button class="btn" id="save-member">Save</button>
          <button id="cancel-member">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="pay-modal">
    <div class="modal-card">
      <h3>Collect Fee</h3>
      <div style="margin-top:12px">
        <div class="form-row">
          <select id="p-member"></select>
          <input id="p-amount" placeholder="Amount (PKR)" type="number" />
        </div>
        <div class="form-row">
          <select id="p-month"><option>January</option><option>February</option><option>March</option><option>April</option><option>May</option><option>June</option><option>July</option><option>August</option><option>September</option><option>October</option><option>November</option><option>December</option></select>
          <input id="p-note" placeholder="Note (optional)" />
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button class="btn" id="submit-pay">Submit & Send WhatsApp</button>
          <button id="cancel-pay">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* --------- Simple data layer using localStorage --------- */
    const store = {
      get(k, fallback){ try{const v=localStorage.getItem(k);return v?JSON.parse(v):fallback;}catch(e){return fallback} },
      set(k,v){localStorage.setItem(k,JSON.stringify(v))},
      clear(){localStorage.clear()}
    }

    // initial data
    let members = store.get('members',[
      {id:1,house:'B-1/98',name:'Ali Khan',phone:'923001234567'},
      {id:2,house:'B-1/99',name:'Sara Ahmed',phone:'923009998877'}
    ])
    let payments = store.get('payments',[])
    let audit = store.get('audit',[])
    let settings = store.get('settings',{prefix:'RCPT',whEnabled:true,year:new Date().getFullYear()})
    let role = 'Admin'

    // helper: generate receipt id RCPT-2025-000001
    function generateReceipt(){
      const year = new Date().getFullYear()
      const prefix = document.getElementById('receipt-prefix')?.value || settings.prefix || 'RCPT'
      // find last with same year
      const sameYear = payments.filter(p=>p.receipt && p.receipt.includes(String(year)))
      const lastNum = sameYear.length? Number(sameYear[sameYear.length-1].num) : 0
      const next = lastNum + 1
      const padded = String(next).padStart(6,'0')
      return {id:`${prefix}-${year}-${padded}`,num:next,year}
    }

    function addAudit(user,module,action,desc){
      const entry = {time: new Date().toLocaleString(), user, module, action, desc}
      audit.unshift(entry)
      audit = audit.slice(0,500) // limit
      store.set('audit',audit)
      refreshAudit()
    }

    /* --------- UI rendering --------- */
    function refreshMembers(){
      store.set('members',members)
      document.getElementById('total-members').innerText = members.length
      const tbody = document.getElementById('members-table')
      tbody.innerHTML = members.map((m,i)=>`<tr><td>${i+1}</td><td>${m.house}</td><td>${m.name}</td><td>${m.phone}</td></tr>`).join('')

      const full = document.getElementById('members-full')
      full.innerHTML = members.map((m,i)=>`<tr><td>${i+1}</td><td>${m.house}</td><td>${m.name}</td><td>${m.phone}</td><td><button class='link' onclick='editMember(${m.id})'>Edit</button></td></tr>`).join('')

      const select = document.getElementById('p-member')
      select.innerHTML = members.map(m=>`<option value='${m.id}'>${m.house} ‚Äî ${m.name}</option>`).join('')
    }

    function refreshPayments(){
      store.set('payments',payments)
      document.getElementById('total-payments').innerText = payments.length
      const recent = document.getElementById('recent-payments')
      recent.innerHTML = payments.slice(0,8).map(p=>`<tr><td>${p.receipt}</td><td>${p.house}</td><td>${p.amount}</td><td>${p.collectedBy}</td></tr>`).join('')

      const tbl = document.getElementById('payments-table')
      tbl.innerHTML = payments.map(p=>`<tr><td>${p.receipt}</td><td>${p.house}</td><td>${p.amount}</td><td>${p.month}</td><td><button class='link' onclick="viewReceipt('${p.receipt}')">View</button></td></tr>`).join('')
    }

    function refreshAudit(){
      store.set('audit',audit)
      const short = document.getElementById('audit-table')
      short.innerHTML = audit.slice(0,10).map(a=>`<tr><td>${a.time}</td><td>${a.user}</td><td>${a.module}</td><td>${a.action}</td></tr>`).join('')
      const full = document.getElementById('audit-full')
      full.innerHTML = audit.map(a=>`<tr><td>${a.time}</td><td>${a.user}</td><td>${a.module}</td><td>${a.action}</td></tr>`).join('')
    }

    function refreshWorkers(){
      const w = store.get('workers',[{name:'Irfan',type:'Security',assigned:'B-1/98'}])
      const t = document.getElementById('workers-table')
      t.innerHTML = w.map((x,i)=>`<tr><td>${i+1}</td><td>${x.name}</td><td>${x.type}</td><td>${x.assigned}</td></tr>`).join('')
    }
    function refreshVehicles(){
      const v = store.get('vehicles',[{house:'B-1/98',vehicle:'HONDA CG',exp:'2026-01-01'}])
      const t = document.getElementById('vehicles-table')
      t.innerHTML = v.map((x,i)=>`<tr><td>${i+1}</td><td>${x.house}</td><td>${x.vehicle}</td><td>${x.exp}</td></tr>`).join('')
    }
    function refreshExpenses(){
      const e = store.get('expenses',[{cat:'Cleaning',amount:2000,date:new Date().toLocaleDateString()}])
      const t = document.getElementById('expenses-table')
      t.innerHTML = e.map((x,i)=>`<tr><td>${i+1}</td><td>${x.cat}</td><td>${x.amount}</td><td>${x.date}</td></tr>`).join('')
    }

    function viewReceipt(id){
      const p = payments.find(x=>x.receipt===id)
      if(!p) return alert('Receipt not found')
      alert(`Receipt: ${p.receipt}\nHouse: ${p.house}\nAmount: ${p.amount}\nMonth: ${p.month}\nCollected by: ${p.collectedBy}`)
    }

    /* --------- actions --------- */
    document.querySelectorAll('.nav-item').forEach(el=>el.addEventListener('click',e=>{
      document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'))
      el.classList.add('active')
      const page = el.getAttribute('data-page')
      document.querySelectorAll('.page').forEach(p=>p.style.display='none')
      document.getElementById(page).style.display='block'
    }))

    // open add member
    document.getElementById('add-member').addEventListener('click',()=>document.getElementById('member-modal').classList.add('open'))
    document.getElementById('cancel-member').addEventListener('click',()=>document.getElementById('member-modal').classList.remove('open'))
    document.getElementById('save-member').addEventListener('click',()=>{
      const house = document.getElementById('m-house').value.trim()
      const name = document.getElementById('m-name').value.trim()
      const phone = document.getElementById('m-phone').value.trim()
      if(!house||!name) return alert('Fill House and Name')
      const id = (members.length?Math.max(...members.map(m=>m.id)):0)+1
      members.unshift({id,house,name,phone})
      addAudit(role,'Members','Add',`Added ${house} ‚Äî ${name}`)
      refreshMembers()
      document.getElementById('member-modal').classList.remove('open')
      document.getElementById('m-house').value=''
      document.getElementById('m-name').value=''
      document.getElementById('m-phone').value=''
    })

    // payments modal
    document.getElementById('show-pay-modal').addEventListener('click',()=>{
      if(role==='Viewer') return alert('You have view-only access')
      if(role==='Recovery' || role==='Admin'){
        document.getElementById('pay-modal').classList.add('open')
      }
    })
    document.getElementById('cancel-pay').addEventListener('click',()=>document.getElementById('pay-modal').classList.remove('open'))

    document.getElementById('submit-pay').addEventListener('click',()=>{
      if(role==='Viewer') return alert('No permission')
      const memberId = Number(document.getElementById('p-member').value)
      const amount = Number(document.getElementById('p-amount').value)
      const month = document.getElementById('p-month').value
      const note = document.getElementById('p-note').value
      if(!memberId||!amount) return alert('Select member and enter amount')
      const member = members.find(m=>m.id===memberId)
      const rc = generateReceipt()
      const rec = `${rc.id}`
      // push payment
      const pay = {receipt:rec,num:rc.num,house:member.house,amount,month,collectedBy:role,at:new Date().toLocaleString(),note}
      payments.unshift(pay)
      addAudit(role,'Payments','Add',`Payment ${rec} ${member.house} ${amount}`)
      refreshPayments()
      document.getElementById('pay-modal').classList.remove('open')

      // WhatsApp send (opens wa.me with message) if enabled
      const enabled = document.getElementById('wh-enable').value === 'true'
      const msg = `Assalam o Alaikum,\nYour monthly committee fee has been received.\n\nHouse: ${member.house}\nAmount: ${amount} PKR\nMonth: ${month}\nReceipt ID: ${rec}\nTime: ${new Date().toLocaleString()}\n\nThank you.`
      if(enabled){
        // open in new window the wa.me link (user can send)
        const phone = member.phone || ''
        const url = `https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(msg)}`
        window.open(url,'_blank')
      }
    })

    // export CSV
    document.getElementById('export-data').addEventListener('click',()=>{
      const rows = [['receipt,house,amount,month,at']]
      payments.forEach(p=>rows.push([`${p.receipt},${p.house},${p.amount},${p.month},${p.at}`]))
      const csv = rows.map(r=>r.join('\n')).join('\n')
      const blob = new Blob([csv],{type:'text/csv'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a');a.href=url;a.download='payments.csv';a.click();URL.revokeObjectURL(url)
    })

    // clear data
    document.getElementById('clear-data').addEventListener('click',()=>{
      if(!confirm('Clear all local demo data?')) return
      store.clear();location.reload()
    })

    // role switching
    document.getElementById('role-switch').addEventListener('change',e=>{
      role = e.target.value
      document.getElementById('current-role').innerText=role
      addAudit(role,'Users','Switch Role',`Switched to ${role}`)
    })

    // settings inputs
    document.getElementById('receipt-prefix').addEventListener('input',e=>{settings.prefix=e.target.value;store.set('settings',settings)})
    document.getElementById('wh-enable').addEventListener('change',e=>{settings.whEnabled = e.target.value === 'true';store.set('settings',settings)})

    // defaulter generation (demo: members with no payment this month)
    document.getElementById('gen-defaulter').addEventListener('click',()=>{
      const month = new Date().toLocaleString('en-US',{month:'long'})
      const paidHouses = new Set(payments.filter(p=>p.month===month).map(p=>p.house))
      const defaulters = members.filter(m=>!paidHouses.has(m.house))
      document.getElementById('defaulter-list').innerHTML = defaulters.length?defaulters.map(d=>`<div>${d.house} ‚Äî ${d.name}</div>`).join(''):'<div class="muted">No defaulters for current month (demo)</div>'
      addAudit(role,'Reports','Generate Defaulter',`Generated defaulter list for ${month}`)
    })

    // search
    document.getElementById('global-search').addEventListener('input',e=>{
      const q = e.target.value.toLowerCase()
      document.querySelectorAll('tbody').forEach(tb=>{
        tb.querySelectorAll('tr').forEach(tr=>{
          tr.style.display = (tr.innerText.toLowerCase().includes(q))?'':'none'
        })
      })
    })

    // edit member function (simple alert demo)
    window.editMember = function(id){
      const m = members.find(x=>x.id===id)
      const newName = prompt('Edit member name',m.name)
      if(newName){m.name=newName;addAudit(role,'Members','Update',`Updated ${m.house} name to ${newName}`);refreshMembers()}
    }

    // initial render
    refreshMembers();refreshPayments();refreshAudit();refreshWorkers();refreshVehicles();refreshExpenses()

    // wire nav start page
    document.querySelectorAll('.nav-item')[0].click()
  </script>
</body>
</html>
